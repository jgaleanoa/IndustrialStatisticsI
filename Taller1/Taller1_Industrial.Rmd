---
header-includes:
- \usepackage{longtable}
- \usepackage[utf8]{inputenc}
- \usepackage[spanish]{babel}\decimalpoint
- \setlength{\parindent}{1.25cm}
- \usepackage{amsmath}
- \usepackage{xcolor}
- \usepackage{cancel}
- \usepackage{array}
- \usepackage{float}
- \usepackage{multirow}
output:
  pdf_document: 
    number_sections: yes
fontsize: 12pt
papersize: letter
geometry: margin = 1in
language: "es"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, fig.align = "center")
library(kableExtra)
library(knitr)
library(tidyverse)
library(qcc)
library(latex2exp)
source("WrappersControl.R", encoding = "UTF-8")
```

```{=tex}
\input{titlepage}
\thispagestyle{empty}
\tableofcontents
```
\newpage

```{=tex}
\pagestyle{myheadings}
\setcounter{page}{3}
```

<!-- Juanjo ------------------------------------------------------ -->

\section{Ejercicio 1}

El peso neto (en onzas) de un producto blanqueador en polvo va a
monitorearse con cartas de control $\bar{x}$ y $R$ utilizando un tamaño de
la muestra de $n = 4$. Se registran datos de 25 muestras.

```{r datos1}
datos1 <- read.table("DatosEJ1.txt", header = T) %>% 
  select(-Numero_de_muestra)
```

\subsection{Prueba de bondad de ajuste a los datos}

La metodología considerada funciona bajo el supuesto de que los datos
provienen de una distribución normal, por lo que es muy importante chequear
dicho supuesto antes de proceder con cálculos. 

```{r hist-ej1, fig.cap="Gráficos para chequeo de normalidad"}
full_sample <- datos1 %>% 
  as.matrix() %>% 
  as.vector() 

qqplot <- ggplot(mapping = aes(sample = full_sample)) +
  geom_qq() +
  geom_qq_line() +
  labs(x = "Cuantiles teóricos", 
       y = "Cuantiles muestrales",
       title = "Gráfico de probabilidad normal") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

hist_peso <- ggplot(mapping = aes(x = full_sample)) +
  geom_histogram(bins = nclass.Sturges(full_sample), 
                 col = "black", fill = "lightgreen") +
  labs(x = "Peso neto (oz)", 
       y = "Frecuencia", 
       title = "Distribución del peso neto(oz)") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

ggpubr::ggarrange(qqplot, hist_peso, nrow = 1, ncol = 2)
```

En el gráfico de probabilidad normal se aprecia que hay múltiples unidades
experimentales que tienen el mismo peso. Aunque los puntos no se desvían
mucho de la recta, dicho supuesto se ve defectuoso en el histograma puesto
que se observa asimetría negativa.

Además de los análisis gráficos, se usa la prueba de normalidad de Shapiro
- Wilk. \newline Sea $X:$ Peso neto de un producto blanqueador en onzas.

\newpage

Se quiere probar

$$
\begin{cases}
H_0: X \sim N(\mu, \sigma^2) \\
H_1: X \nsim N(\mu, \sigma^2) 
\end{cases}
$$

Luego de realizar la prueba de normalidad se obtienen los siguientes
resultados

```{r shapiro-wilk1}
test_norm <- data.frame(W = 0.9665, pvalue = 0.01201)
kable(test_norm, longtable = T, booktabs = T, 
      caption = "Prueba de normalidad", 
      col.names = c("W", "Valor-p"))
```

El valor-p es polémico a un nivel de significancia $\alpha = 0.01$ debido a
que se encuentra muy cerca del límite de decisión. Si bien dicho valor es
mayor a 0.01, no rechazar $H_0$ es una decisión poco fiable.

Vistos los análisis previos, se considera que la distribución normal no se
ajusta bien al peso neto del producto blanqueador, sin embargo para fines 
de ilustrar la metodología de control del proceso se asume que las
desviaciones del supuesto no son muy graves.

\subsection{Gráficos de control para $\bar{x}$ y $R$}

Inicialmente se debe verificar el gráfico de Shewhart para R puesto que los
límites de control para $\bar{x}$ dependen de $R$, luego es necesario
asegurarse que la variabilidad de $R$ este bajo control antes de proceder
con $\bar{x}$.

$$
\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i \hspace{.2in} \bar{\bar{x}} = \frac{1}{m} \sum_{i=1}^{m} \bar{x}_i \hspace{.2in} \bar{R} = \frac{1}{m} \sum_{i=1}^m R_i
$$

\begin{table}[H]
\centering
\caption{Límites de control para $\bar{x}$ y $R$}
\begin{tabular}{|l|l|l|l|}
\hline
   & LCL & CL & UCL \\ \hline
$\bar{x}$  & $\bar{\bar{x}} - A_2 \bar{R}$   & $\bar{\bar{x}}$  & $\bar{\bar{x}} + A_2 \bar{R}$   \\ \hline
$R$ & $\bar{R}D_3$   & $\bar{R}$  & $\bar{R}D_4$ \\ \hline  
\end{tabular}
\end{table}

```{r control-R, fig.height=6, fig.width=6}
control_r1 <- qcc(datos1, type = "R", title= "Gráfico de Shewhart para R",
                  xlab = "Muestra", ylab = "Rango", plot = F)
sdcontrolchart(control_r1) +
  labs(title = "Gráfico de Shewart para R", y = "Rango")
```

Puesto que ningún punto cae fuera de los límites de control ni tampoco se
observan patrones sistemáticos en el gráfico, se puede proceder a la
construcción del diagrama de Shewhart para $\bar{x}$.

```{r control-xbar, fig.height=6, fig.width=6}
control_xbar1 <- qcc(datos1, type = "xbar", 
                     title = "Gráfico de Shewhart para el peso promedio",
                     xlab = "Muestra", ylab = "Peso promedio (oz)", plot = F)
meancontrolchart(control_xbar1) +
  labs(title = TeX("Gráfico de Shewart para $\\bar{x}$"), 
       y = "Peso promedio (oz)")
```

Similar al caso de $R$, todos los puntos caen dentro de los límites de
control y no se observan patrones sistemáticos, se puede concluir que el
proceso está bajo control. 

Para finalizar, se verifica el valor de los límites de control obtenidos en
R con el paquete `qcc` luego de hacer los cálculos manuales.

```{r calculos-manuales}
x_doble_bar <- apply(datos1, 1, mean) %>% 
  mean()
R_bar <- apply(datos1, 1, function(x) max(x) - min(x)) %>% 
  mean()
```


$$
\bar{\bar{x}} = \frac{1}{25} \sum_{i=1}^{25} \bar{x}_i = `r x_doble_bar` \hspace{.2in} \bar{R} = \frac{1}{25} \sum_{i=1}^{25} R_i = 0.464
$$

**Para $\bar{x}$**

Se tiene que $n = 4$, luego $A_2 = 0.729$ por lo tanto los límites de
control son

$$
\begin{aligned}
\text{UCL} &= `r x_doble_bar` + 0.729 \times `r R_bar`=`r x_doble_bar + 0.729*R_bar` \\
\text{LCL} &= `r x_doble_bar` - 0.729 \times `r R_bar`=`r x_doble_bar - 0.729*R_bar`
\end{aligned}
$$
estos límites concuerdan con los obtenidos en R.

**Para R**

Nuevamente, debido a $n = 4$ se tiene $D_3 = 0$ y $D_4 = 2.282$, así

$$
\begin{aligned}
\text{UCL} &= `r R_bar` \times 2.282 = `r R_bar*2.282` \\
\text{LCL} &= `r R_bar` \times 0 = 0
\end{aligned}
$$
los cuales también concuerdan con los obtenidos en el lenguaje de programación
R.

\subsection{Estimación de media y varianza del proceso}

Una vez verificado el control del proceso, resulta de interés estimar los
parámetros $\mu$ y $\sigma$ de la distribución normal para realizar
cálculos como lo puede ser, el porcentaje de producto blanqueador cuyo 
peso neto este fuera de los límites de control.

El estimador de $\mu$ es $\bar{\bar{x}} = 16.239$ el cual fue calculado en
el inciso anterior. Por otro lado, para la desviación estándar se tiene
$\hat{\sigma} = \frac{\bar{R}}{d_2}$; en el inciso anterior se llegó a
$\bar{R} = `r R_bar`$ y además para $n = 4$ se tiene $d_2 = 2.059$
obteniendo así $\hat{\sigma} = \frac{0.464}{2.059} = `r 0.464/2.059`$.

En resumen

$$
\hat{\mu} = 16.239 \hspace{.35in} \hat{\sigma} = `r 0.464/2.059`
$$

\subsection{Porcentaje de defectuosos}

Suponiendo que el fabricante establece como medidas de especificación para
el peso del producto blanqueador $16 \pm 0.75 \text{ oz}$ el porcentaje de
defectuosos se puede calcular como 
$\left[1 - \mathbb{P}(15.25\leq X \leq 16.75)\right] \times 100\%$
con $X \sim N\left(16.239, \ 0.2253521^2\right)$.

```{r porc-def}
prob_in <- pnorm(16.75, 16.239, 0.2253521) - pnorm(15.25, 16.239, 0.2253521)
```

Se puede verificar que $\mathbb{P}(15.25\leq X \leq 16.75) = `r prob_in`$
por lo que el porcentaje de productos defectuosos es 
$(1 - `r prob_in`) \times 100\% = `r (1 - prob_in)*100` \%$, es decir, la
cantidad de producto blanqueador producido cuyo peso será menor a 15.25 o
mayor a 16.75 oz es aproximadamente el 1.1684 \%.

\subsection{ARL del proceso}

Se define $\alpha: \mathbb{P}(\text{Detectar desplazamiento de media | La media NO se desplazo})$. \newline
Teniendo en cuenta que el proceso se encuentra en control y además se está
trabajando con 3 desviaciones estándar (lo cual implica $\alpha = 0.0027$)
el número de esperado de muestras que se deben inspeccionar hasta encontrar
una fuera de control es:

$$
\text{ARL}_0 = \frac{1}{\alpha} = \frac{1}{0.0027} = 370.3704
$$


\subsection{Desplazamiento de media}

Se define $\beta = \mathbb{P}(\text{No detectar el desplazamiento de media | La media se desplazo})$. 
Si la media del proceso se desplaza a $\mu_1 = 16.2$ y la desviación
estándar permanece constante, entonces:

$$
\bar{x} \sim N\left(16.2, \frac{0.2253521^2}{4}\right)
$$

```{r beta}
sigma1 <- R_bar/2.059
beta1 <- pnorm(16.577256, 16.2, sigma1/2) - pnorm(15.900744, 16.2, sigma1/2)
first_sample <- beta1^(1 - 1)*(1 - beta1)
```


$$
\begin{aligned}
\beta &= \mathbb{P}(15.900744 \leq \bar{x} \leq 16.577256 \ | \ \hat{\mu} = 16.2, \ \hat{\sigma} = 0.2253521) \\
&= `r beta1`
\end{aligned} 
$$
Sea $Y: \text{Número de muestras revisadas hasta detectar cambio en la media del proceso}$

$$
\begin{aligned}
&Y \sim Geo(1 - \beta) \Leftrightarrow p_Y(y) = \beta^{y-1}(1 - \beta) \ \text{con} \ \beta = `r beta1` \\
&\mathbb{P}(Y = 1) = `r 1-beta1`
\end{aligned}
$$

El cual es un resultado razonable teniendo en cuenta que el desplazamiento
de la media fue pequeño numéricamente hablando (0.039 oz).

\subsection{Muestras necesarias para detectar cambios}

Para este caso se quiere calcular el $ARL_1$ puesto que
se esta suponiendo un proceso fuera de control por una diferencia de 0.039
respecto al promedio del proceso cuando está en control.

$ARL_1 = \frac{1}{1-\beta} = \frac{1}{1-`r beta1`} = `r 1/(1 - beta1)`$, es
decir, el número esperado de muestras a revisar hasta encontrar un cambio en
el peso del producto blanqueador de 0.039 oz es aproximadamente 229.27
muestras.

\subsection{Curva de operación característica}

Para finalizar, se gráfica la curva de operación característica (OC), la
cual ilustra como disminuye $\beta$ a medida que el desplazamiento de la
media aumenta para diferentes tamaños de muestra.

```{r aux_chunk, include=F}
qcc_curve <- oc.curves(control_xbar1, n = 5*1:4)
```

```{r oc_curve, warning=F}
oc_data <- matrix(qcc_curve, ncol = 1) %>% 
  cbind(n = rep(5*1:4, each = nrow(qcc_curve)),
        beta = as.numeric(rownames(qcc_curve))) %>% 
  as.data.frame() %>% 
  mutate(n = as.factor(n))
colnames(oc_data) <- c("beta", "n", "k")

ggplot(oc_data, aes(k, beta)) +
  geom_line(aes(color = n), size = 0.75) +
  xlim(0, 3) +
  labs(title = "Curva de operación característica",
       y = TeX("$beta$")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

* Cuando el tamaño de muestra aumenta la probabilidad de no detectar el
cambio cuando hay desplazamiento de media, disminuye
* La potencia $(1 - \beta)$ para detectar cambios en el proceso comienza a
aumentar cuando el desplazamiento es de aproximadamente 0.5 desviaciones
estándar.
* Para desplazamientos de aproximadamente 1.5 desviaciones estándar los
valores de $\beta$ son muy cercanos a cero para $n \in \{10,15,20\}$, sin
embargo dicho tamaños de muestra ya se pueden considerar grandes por lo que
no sería adecuado usar el rango como medida de dispersión.
* Para $n=5$ los valores de $\beta$ tienden a cero para valores de $k$ un
poco mayores a 2, alcanzando el 0 aproximadamente en $k=2.5$

<!-- Gaviria ----------------------------------------------------- -->

\section{Ejercicio 2}

El volumen de llenado de las botellas de refresco es una característica
de calidad importante. El volumen se mide colocando un medidor sobre la
boca de la botella y comparando la altura del líquido en el cuello de la
botella con una escala codificada. En esta escala, una lectura cero
corresponde a la altura de llenado correcta. Se analizan 25 muestras de
tamaño 9. La estructura de los datos se muestra como sigue:

```{r datos punto 2}
bd <- read.table("bdp2.txt", header = T)
kable(head(bd), caption = "Primeras 6 muestras de 25",
      align = 'c',
      longtable = T,
      booktab= T)
```

\subsection{Literal a}

Para verificar la normalidad de los datos muestrales, se puede acudir a
diferentes métodos. Para este caso, haciendo uso de la prueba formal de
Shapiro-Wilk acompañada de un elemento gráfico se obtiene lo siguiente:

```{r gráfico normalidad punto 2, fig.cap="Prueba de normalidad punto 2", fig.pos='H', fig.height=3.5}
bda <- data.frame(Muestra = rep(1:25,9), X = c(bd$X1,bd$X2,bd$X3,bd$X4,bd$X5,bd$X6,
                                               bd$X7,bd$X8,bd$X9))

ggplot(bda, aes(sample = X)) +
  stat_qq() +
  stat_qq_line() +
  labs(x = "Cuantiles Teóricos", y = "Cuantiles Reales", title = "Gráfico Cuantil-Cuantil") +
  geom_label(aes(x = -2, y = 2.3, label = "Resultado Shapiro-Wilk\n W = 0.9969\n Valor-P = 0.9445"))+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))

```

Con el gráfico anterior se puede concluir que: dado que los puntos se
ajustan bien a la recta normal, se puede decir que los datos de la
muestra provienen de una población que se distribuye normalmente. Por
otro lado, usando cualquier nivel de significancia usual, la prueba de
Shapiro Wilk concluye con evidencia fuerte el buen ajuste de los datos a
una distribución normal.

\subsection{Literal b}

Para verificar si el proceso de llenado de las botellas está controlado,
se puede recurrir a las gráficas de control $\bar{x}$ y S ya que en este
caso, el tamaño de muestra es moderadamente grande.

Así pues, inicialmente se debe verificar que la desviación del proceso
está en control, y para esta causa se plantea el siguiente gráfico de
control:

```{r gráfico para la desviacion, fig.cap="Gráfico de control para la desviación", fig.pos='H', fig.height=3.5}
sdqcc <- qcc(bd[,-1], type="S", plot= F)
sdcontrolchart(sdqcc)
```

Así, de este último se aprecia que, el subgrupo 7 de la muestra presenta
una desviación por encima del límite de control superior, por lo tanto
se procede a recalcular lo anterior sin este.

```{r gráfico para la desviacion2, fig.cap="Gráfico de control para la desviación", fig.pos='H', fig.height=3.5}
sdqcc2 <- qcc(bd[-7,-1], type="S", plot= F)
sdcontrolchart(sdqcc2)
```

Finalmente, después de eliminar el subgrupo 7, se obtiene un proceso con
varianza en control y por lo tanto se puede proceder a obtener el
gráfico de control para $\bar{x}$ como se muestra a continuación:

```{r gráfico para la media, fig.cap="Gráfico de control para la media", fig.pos='H', fig.height=3.5}
meanqcc <- qcc(bd[-7,-1], type="xbar",std.dev = "UWAVE-SD", plot = F)
meancontrolchart(meanqcc)
```

De acá se puede apreciar que la media del proceso aún no se encuentra en
control puesto que, la muestra 20 presenta un promedio por encima del
límite de control superior. Así entonces, se procede a eliminar el
mencionado y a recalcular lo anterior como sigue:

```{r gráfico para la media2, fig.cap="Gráfico de control para la media", fig.pos='H', fig.height=3.5}
meanqcc2 <- qcc(bd[-c(7,20),-1], type="xbar",std.dev = "UWAVE-SD", plot = F)
meancontrolchart(meanqcc2)
```

Concluyendo, en la fase I se logró detectar inicialmente que la varianza
del proceso estaba fuera de control gracias al subgrupo racional número 7.
Posteriormente se eliminó esta observación de la muestra y se logró
obtener una desviación del proceso dentro de los límites. Así
entonces, se construyó la gráfica de control para la media, encontrando
que el subgrupo 20 no permitía un proceso centrado. Sin embargo,
después de eliminar el mismo, se obtuvieron la gráficas de control
deseadas para un proceso que se encuentra operando de manera contenida.

\subsection{Literal c}

Luego de realizar lo anterior, es de interés calcular la media y la
desviación estándar del proceso sin incluir las observaciones depuradas
en el literal b.

Así entonces, la expresión para calcular la media del proceso
$\bar{\bar{x}}$ está dada por:

$$
\bar{\bar{x}} = \frac{1}{m}\sum_{i=1}^m \bar{x_i}
$$

Donde $\bar{x_i}$ es la media dentro de cada subgrupo.

Por otro lado, para la desviación se debe tener en cuenta que su
respectivo estimador insesgado se encuentra dado por la siguiente
expresión:

$$
\hat{\sigma} = \frac{S}{C4}
$$

Donde S está dado por:

$$
S = \sqrt{\frac{1}{n-1}\sum_{i=1}^n(x_i-\bar{x})^2}
$$

Y C4 es una constante para n = 9

Usando los datos en las expresiones anteriores se obtiene que la media
del proceso $\bar{\bar{x}}$ es -0.047 y la desviación $\hat{\sigma}$ es
0.977

\subsection{Literal d}

Para calcular $\widehat{C_{pk}}$ se conoce la siguiente expresión:

$$
\widehat{C_{pk}} = min(\frac{LES-\hat{\mu}}{3\hat{\sigma}}, \frac{\hat{\mu}-LEI}{3\hat{\sigma}})
$$

Sabiendo que LEI = -0.05, LES = 0.05, $\hat{\mu}$ = $\bar{\bar{x}}$ =
-0.047 y $\hat{\sigma}$ = 0.977, se llega a que:

$$
\widehat{C_{pk}} = min(0.1866, 0.1546) = 0.1546
$$ De este índice se puede afirmar que el proceso es deficiente si lo
que se busca es cumplir con una tolerancia de 0.5 unidades, dado que el
índice de capacidad real se encuentra por debajo de 1. Este resultado es
congruente con la gráfica de control de $\bar{x}$, puesto que los
límites de control para el proceso de llenado de las botellas se
encuetran por fuera de los límites de especificación y por lo tanto, el
resultado obtenido en la expresión de arriba es congruente con la
gráfica de control final.

Por otro lado, se tiene que un IC al 95% para $\widehat{C_{pk}}$ está
dado por:

$$
\widehat{C_{pk}}[1\pm Z_{0.025}\sqrt{\frac{1}{9n\widehat{C_{pk}}}+\frac{1}{2n-1}}]
$$

Y con esto, sabiendo que n = 9, se tiene que:

$$
\widehat{C_{pk}} \in (0.0418, 0.2674)
$$ Es decir, con una significancia usual el valor verdadero $C_{pk}$ se
encuentra contenido en el anterior intervalor.

\subsection{Literal e}

\subsection{Literal f}

Se toman 15 nuevas muestras del proceso de llenado de botellas. Se
quiere entonces incurrir en la fase II del proceso, analizando estos
nuevos datos en los gráficos de control obtenidos anteriormente. Los
gráficos de control para $\bar{x}$ y S incluyendo esta nueva muestra se
presentan como sigue:

```{r fase II punto 2, fig.cap="Gráficos de control fase II", fig.pos='H', fig.height=3.2}
bd2f <- read.table("bdp2f.txt", header = T)

sdqcc2f <- qcc(bd[-c(7,20),-1], type="S",newdata=bd2f, plot = F)

meanqcc2f <- qcc(bd[-c(7,20),-1], type="xbar", newdata=bd2f,std.dev = "UWAVE-SD", plot = F)

sdqccdf2 <- data.frame(Subgrupo=1:24, Desviaciones=sdqcc2$statistics)

p1 <- ggplot(sdqccdf2, aes(Subgrupo, Desviaciones)) +
  geom_point() +
  geom_path()+
  geom_point(data = data.frame(Subgrupo=24:28,
                               Desviaciones=sdqcc2f$newstats[1:5]),
             colour = "black")+
  geom_path(data = data.frame(Subgrupo=23:28,
                               Desviaciones=c(sdqcc2$statistics[23],
                                              sdqcc2f$newstats[1:5])))+
  geom_point(data = data.frame(Subgrupo=29:38,
                               Desviaciones=sdqcc2f$newstats[6:15]),
             colour = "red")+ 
  geom_path(data = data.frame(Subgrupo=28:38,
                               Desviaciones=sdqcc2f$newstats[5:15]))+
  geom_line()+
  geom_vline(xintercept = 23.5, linetype="dashed")+
  geom_hline(yintercept=sdqcc2$limits[1], linetype="dashed",size=1)+
  geom_hline(yintercept=sdqcc2$limits[2], linetype="dashed",size=1)+
  geom_hline(yintercept=sdqcc2$center, linetype="dashed",size=1)+
  geom_label(aes(x = 38, y = sdqcc2$limits[1], label = "LCL"))+
  geom_label(aes(x = 38, y = sdqcc2$limits[2], label = "UCL"))+
  geom_label(aes(x = 38, y = sdqcc2$center, label = "CL"))+
  geom_label(aes(x = 0, y = sdqcc2$limits[1], label = round(sdqcc2$limits[1],3)))+
  geom_label(aes(x = 0, y = sdqcc2$limits[2], label = round(sdqcc2$limits[2],3)))+
  geom_label(aes(x = 0, y = sdqcc2$center, label = round(sdqcc2$center,3)))+
  labs(title="Gráfico de control para desviaciones")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))

meanqccdf2 <- data.frame(Subgrupo=1:23, Promedios=meanqcc2$statistics)

p2 <- ggplot(meanqccdf2, aes(Subgrupo, Promedios)) +
  geom_point() +
  geom_path()+
  geom_point(data = data.frame(Subgrupo=24:26,
                               Promedios=meanqcc2f$newstats[1:3]),
             colour = "black")+
  geom_path(data = data.frame(Subgrupo=23:26,
                              Promedios=c(meanqcc2$statistics[23],
                                          meanqcc2f$newstats[1:3])))+
  geom_point(data = data.frame(Subgrupo=27, Promedios=meanqcc2f$newstats[4]),
             colour = "red")+
  geom_path(data = data.frame(Subgrupo = 26:27,
                              Promedios = meanqcc2f$newstats[3:4]))+
  geom_point(data = data.frame(Subgrupo=28, Promedios=meanqcc2f$newstats[5]),
             colour = "black")+
  geom_path(data = data.frame(Subgrupo = 27:28,
                              Promedios = meanqcc2f$newstats[4:5]))+
  geom_point(data = data.frame(Subgrupo=29:38,
                               Promedios=meanqcc2f$newstats[6:15]),
             colour = "red")+ 
  geom_path(data = data.frame(Subgrupo=28:38,
                              Promedios=meanqcc2f$newstats[5:15]))+
  geom_line()+
  geom_vline(xintercept = 23.5, linetype="dashed")+
  geom_hline(yintercept=meanqcc2$limits[1], linetype="dashed",size=1)+
  geom_hline(yintercept=meanqcc2$limits[2], linetype="dashed",size=1)+
  geom_hline(yintercept=meanqcc2$center, linetype="dashed",size=1)+
  geom_label(aes(x = 38, y = meanqcc2$limits[1], label = "LCL"))+
  geom_label(aes(x = 38, y = meanqcc2$limits[2], label = "UCL"))+
  geom_label(aes(x = 38, y = meanqcc2$center, label = "CL"))+
  geom_label(aes(x = 0, y = meanqcc2$limits[1], label = round(meanqcc2$limits[1],3)))+
  geom_label(aes(x = 0, y = meanqcc2$limits[2], label = round(meanqcc2$limits[2],3)))+
  geom_label(aes(x = 0, y = meanqcc2$center, label = round(meanqcc2$center,3)))+
  labs(title="Gráfico de control para promedios")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))

p1
p2
```

De este par de gráficos de control, se aprecian graves problemas en la
desviación del proceso y un desplazamiento importante de la media.
Específicamente, podría hablarse de alguna novedad importante en los
factores asignables que componen el proceso de llenado de las botellas
que no se debe pasar por alto.

<!-- Juanjo ------------------------------------------------------ -->

\section{Ejercicio 5}

<!-- Simon ------------------------------------------------------- -->

\section{Ejercicio 6}
